<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Dados do Formulário</title>
</head>
<body>

<form id="meuFormulario" enctype="multipart/form-data">
    <label for="title">Title:</label>
    <input type="text" id="title" name="title"><br><br>

    <label for="description">Description:</label>
    <input type="text" id="description" name="description"><br><br>

    <label for="text">Text:</label>
    <input type="text" id="text" name="text"><br><br>

    <label for="type">Type:</label>
    <input type="text" id="type" name="type"><br><br>

    <label for="tb_category_uuid">tb_category_uuid:</label>
    <input type="text" id="tb_category_uuid" name="category_uuid"><br><br>

    <label for="tb_user_uuid">tb_user_uuid:</label>
    <input type="text" id="tb_user_uuid" name="user_uuid"><br><br>

    <label for="images">Imagens:</label>
    <input type="file" id="images" name="imagens" multiple><br><br>

    <button type="button" onclick="enviarFormulario()">Enviar</button>
</form>

<script>

    async function sendDataToServer(data) {
        fetch('/projetosdiasdev/api/post/news', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(async response => {
                if (response.ok) {
                    // Sucesso
                    const responseData = await response.json();
                    alert('Código HTTP: ' + response.status + '\nMensagem: ' + responseData.message);
                    // Limpar o formulário se necessário
                    document.getElementById('meuFormulario').reset();
                } else {
                    // Erro
                    const errorData = await response.json();
                    throw new Error('Código HTTP: ' + response.status + '\nErro: ' + errorData.message);
                }
            })
            .catch(error => {
                alert('Erro ao postar notícia: ' + error.message);
            });
    }




    function enviarFormulario() {
        // Capturar os valores do formulário
        var title = document.getElementById("title").value;
        var description = document.getElementById("description").value;
        var text = document.getElementById("text").value;
        var type = document.getElementById("type").value;
        var tb_category_uuid = document.getElementById("tb_category_uuid").value;
        var tb_user_uuid = document.getElementById("tb_user_uuid").value;
        var images = document.getElementById("images").files; // Capturar as imagens selecionadas

        // Criar um objeto para armazenar os dados
        var dados = {
            title: title,
            description: description,
            text: text,
            type: type,
            tb_category_uuid: tb_category_uuid,
            tb_user_uuid: tb_user_uuid,
            images: [] // Inicializar um array para armazenar os URLs de dados das imagens
        };

        // Iterar sobre cada imagem selecionada
        for (var i = 0; i < images.length; i++) {
            // Criar um novo FileReader
            var reader = new FileReader();
            // Definir uma função de callback para quando a leitura do arquivo for concluída
            reader.onload = function(event) {
                // Adicionar o URL de dados da imagem ao array de imagens no objeto dados
                dados.images.push(event.target.result);

                // Verificar se todas as imagens foram processadas
                if (dados.images.length === images.length) {
                    // Mostrar os dados no console como JSON
                    //console.log(JSON.stringify(dados));
                    sendDataToServer(dados);
                }
            };

            // Ler a imagem como um URL de dados (Base64)
            reader.readAsDataURL(images[i]);
        }
    }

</script>

</body>
</html>



